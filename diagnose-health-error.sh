#!/bin/bash

echo "=========================================="
echo "å¥åº·æ£€æŸ¥é”™è¯¯è¯Šæ–­"
echo "=========================================="
echo ""

echo "ğŸ“Š 1. æŸ¥çœ‹ PM2 æœåŠ¡çŠ¶æ€"
echo "----------------------------------------"
pm2 status

echo ""
echo "ğŸ“Š 2. æŸ¥çœ‹æœ€è¿‘çš„é”™è¯¯æ—¥å¿—ï¼ˆæœ€å 50 è¡Œï¼‰"
echo "----------------------------------------"
pm2 logs caigou-api --lines 50 --err

echo ""
echo "ğŸ“Š 3. æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ï¼ˆæœ€å 100 è¡Œï¼‰"
echo "----------------------------------------"
pm2 logs caigou-api --lines 100

echo ""
echo "ğŸ“Š 4. æ£€æŸ¥æ•°æ®åº“è¿æ¥"
echo "----------------------------------------"
mysql -u root -p -e "SELECT 1;" 2>&1 | head -n 5

echo ""
echo "ğŸ“Š 5. æ£€æŸ¥ Prisma æœåŠ¡æ˜¯å¦æ­£å¸¸"
echo "----------------------------------------"
echo "æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„ DATABASE_URL é…ç½®ï¼š"
cd /root/caigou/caigou/apps/api
if [ -f .env ]; then
    grep DATABASE_URL .env | sed 's/password=[^@]*@/password=***@/g'
else
    echo "âš ï¸  .env æ–‡ä»¶ä¸å­˜åœ¨"
fi

echo ""
echo "ğŸ“Š 6. æ£€æŸ¥æœåŠ¡ç«¯å£æ˜¯å¦è¢«å ç”¨"
echo "----------------------------------------"
ss -tlnp | grep 8081

echo ""
echo "=========================================="
echo "è¯Šæ–­å®Œæˆ"
echo "=========================================="

