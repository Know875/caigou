# 修复高 CPU 使用率问题

## 🚨 问题确认

从系统监控看：
- **系统负载**: 8.47, 8.66, 8.60（非常高）
- **CPU 使用率**: 88.9% us, 0.0% id（CPU 完全满载）
- **异常进程**: PID 155845，进程名 `fghgf`，占用 **176.9% CPU**

**结论**：问题不在数据库或应用代码，而是有一个**异常进程**占用了大量 CPU 资源！

---

## 🔍 立即检查异常进程

### 1. 查看异常进程详细信息

```bash
# 查看进程详细信息
ps aux | grep -E "155845|fghgf" | grep -v grep

# 查看进程的完整命令行
ps -fp 155845

# 查看进程的网络连接
ss -tunp | grep 155845

# 查看进程的工作目录
ls -la /proc/155845/cwd

# 查看进程的可执行文件
ls -la /proc/155845/exe
```

### 2. 查看 CPU 使用率最高的进程

```bash
ps aux --sort=-%cpu | head -n 15
```

---

## 🛠️ 处理方案

### 方案 1：如果是恶意进程（推荐）

**如果确认是恶意进程，立即终止**：

```bash
# 1. 终止进程
kill -9 155845

# 2. 确认进程已终止
ps aux | grep 155845

# 3. 检查系统负载是否下降
top -b -n 1 | head -n 20
```

### 方案 2：如果是系统进程

**如果是系统进程，需要进一步调查**：

```bash
# 1. 查看进程的完整信息
cat /proc/155845/cmdline
cat /proc/155845/environ

# 2. 查看进程的父进程
ps -ef | grep 155845

# 3. 查看系统日志
journalctl -n 100 | grep -i "155845\|fghgf"
```

### 方案 3：如果是挖矿程序

**如果确认是挖矿程序，需要彻底清理**：

```bash
# 1. 终止进程
kill -9 155845

# 2. 检查是否有定时任务
crontab -l
cat /etc/crontab
ls -la /etc/cron.d/

# 3. 检查系统服务
systemctl list-units --type=service | grep -i "fghgf\|suspicious"

# 4. 检查启动脚本
ls -la /etc/init.d/ | grep -i "fghgf"
ls -la /etc/systemd/system/ | grep -i "fghgf"
```

---

## ⚠️ 安全建议

1. **立即终止异常进程**
2. **检查系统是否被入侵**
3. **检查定时任务和启动脚本**
4. **检查网络连接**
5. **考虑重装系统**（如果确认被入侵）

---

## 📋 立即执行的命令

```bash
# 1. 查看异常进程详细信息
ps aux | grep -E "155845|fghgf" | grep -v grep
ps -fp 155845

# 2. 查看进程的可执行文件位置
ls -la /proc/155845/exe

# 3. 终止异常进程（如果确认是恶意进程）
kill -9 155845

# 4. 检查系统负载是否下降
top -b -n 1 | head -n 20

# 5. 检查是否有定时任务
crontab -l
cat /etc/crontab
```

---

## 🎯 预期效果

终止异常进程后：
- CPU 使用率应该从 88.9% 降到 10-30%
- 系统负载应该从 8.47 降到 1-2
- 应用性能应该显著提升

---

## ⚠️ 重要提示

1. **先确认进程性质**：不要盲目终止，先查看进程信息
2. **备份重要数据**：如果确认被入侵，立即备份数据
3. **检查系统完整性**：检查是否有其他异常进程或文件

