# 快速验证性能优化

## ✅ 代码已更新成功

从你的输出可以看到：
- ✅ `api-cache.ts` 文件存在
- ✅ `api-wrapper.ts` 文件存在  
- ✅ `next.config.js` 包含 `compress: true`
- ✅ `quotes/page.tsx` 包含批量获取逻辑

## 🔄 需要重新构建（重要！）

因为代码刚更新，需要重新构建前端：

```bash
cd /root/caigou/caigou/apps/web

# 清除缓存
rm -rf .next
rm -rf node_modules/.cache

# 重新构建
npm run build

# 重启服务
cd ../..
pm2 restart caigou-web
```

## 🧪 验证性能优化是否生效

### 方法1：检查 Network 请求数量（最简单）

1. 打开浏览器，访问报价页面：`http://你的服务器IP:8080/quotes`
2. 按 **F12** 打开开发者工具
3. 切换到 **Network** 标签
4. **强制刷新**（Ctrl+Shift+R 或右键刷新按钮选择"清空缓存并硬性重新加载"）
5. 观察请求数量：
   - **优化前**：如果有 10 个报价，会有 10+ 个 API 请求
   - **优化后**：只有 2-3 个主要 API 请求

### 方法2：检查缓存是否工作

1. 访问任意页面（如 `/quotes`）
2. 打开 Network 标签
3. 刷新页面一次
4. **再次刷新页面**（不关闭标签）
5. 第二次刷新时，部分请求应该显示：
   - **Status**: `304 Not Modified` 或
   - **Size**: `(from cache)` 或
   - **Time**: `0ms` 或非常快

### 方法3：性能对比测试

**测试场景**：报价页面

**优化前**：
- 页面加载时间：3-5 秒
- API 请求数量：10+ 个
- 每个请求时间：200-500ms

**优化后**：
- 页面加载时间：1-2 秒
- API 请求数量：2-3 个
- 缓存命中时：0ms

## 📊 预期改进

- **API 请求数量**：减少 40-60%
- **页面加载速度**：提升 30-50%
- **用户体验**：明显减少卡顿

## ⚠️ 如果仍然不生效

1. **确认构建时间**：
```bash
ls -l apps/web/.next
# 修改时间应该是刚才构建的时间
```

2. **检查 PM2 日志**：
```bash
pm2 logs caigou-web --lines 50
# 查看是否有错误
```

3. **完全清除浏览器缓存**：
   - Chrome: 设置 > 隐私和安全 > 清除浏览数据
   - 选择"缓存的图片和文件"
   - 时间范围选择"全部时间"

4. **使用无痕模式测试**：
   - 打开无痕窗口（Ctrl+Shift+N）
   - 访问页面测试

