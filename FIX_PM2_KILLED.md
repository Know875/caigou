# ä¿®å¤ PM2 "Killed" é”™è¯¯

## ğŸ” é—®é¢˜åˆ†æ

`Killed` é”™è¯¯é€šå¸¸è¡¨ç¤ºï¼š
1. **å†…å­˜ä¸è¶³ï¼ˆOOMï¼‰**ï¼šç³»ç»Ÿå†…å­˜è€—å°½ï¼Œå†…æ ¸æ€æ­»äº†è¿›ç¨‹
2. **PM2 å®ˆæŠ¤è¿›ç¨‹é—®é¢˜**ï¼šPM2 å®ˆæŠ¤è¿›ç¨‹å´©æºƒ
3. **ç³»ç»Ÿèµ„æºé™åˆ¶**ï¼šè¾¾åˆ°ç³»ç»Ÿèµ„æºé™åˆ¶

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šæ¸…ç†å†…å­˜å¹¶é‡å¯ PM2ï¼ˆæ¨èï¼‰

```bash
# 1. æ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µ
free -h

# 2. æ¸…ç† PM2 æ—¥å¿—ï¼ˆé‡Šæ”¾ç£ç›˜ç©ºé—´ï¼‰
pm2 flush

# 3. åœæ­¢æ‰€æœ‰ PM2 è¿›ç¨‹
pm2 kill

# 4. ç­‰å¾…å‡ ç§’
sleep 3

# 5. é‡æ–°å¯åŠ¨ PM2 å®ˆæŠ¤è¿›ç¨‹
pm2 resurrect

# 6. å¦‚æœ resurrect å¤±è´¥ï¼Œæ‰‹åŠ¨å¯åŠ¨æœåŠ¡
cd /root/caigou/caigou
pm2 start ecosystem.config.js
```

### æ–¹æ¡ˆ 2ï¼šå¢åŠ ç³»ç»Ÿå†…å­˜æˆ–äº¤æ¢ç©ºé—´

å¦‚æœå†…å­˜ä¸è¶³ï¼š

```bash
# æ£€æŸ¥æ˜¯å¦æœ‰äº¤æ¢ç©ºé—´
swapon --show

# å¦‚æœæ²¡æœ‰äº¤æ¢ç©ºé—´ï¼Œå¯ä»¥åˆ›å»ºï¼ˆéœ€è¦ root æƒé™ï¼‰
# æ³¨æ„ï¼šè¿™éœ€è¦è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
```

### æ–¹æ¡ˆ 3ï¼šå‡å°‘ PM2 å®ä¾‹æ•°é‡

å¦‚æœå†…å­˜ä¸è¶³ï¼Œå¯ä»¥å‡å°‘é›†ç¾¤å®ä¾‹æ•°ï¼š

```bash
# ç¼–è¾‘ ecosystem.config.js
# å°† instances ä» 2 æ”¹ä¸º 1
# ç„¶åé‡å¯
pm2 delete all
pm2 start ecosystem.config.js
```

### æ–¹æ¡ˆ 4ï¼šæ£€æŸ¥å¹¶æ¸…ç†ç³»ç»Ÿ

```bash
# 1. æ£€æŸ¥æ˜¯å¦æœ‰åƒµå°¸è¿›ç¨‹
ps aux | grep defunct

# 2. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# 3. æ¸…ç†ç³»ç»Ÿç¼“å­˜ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
sync
echo 3 > /proc/sys/vm/drop_caches
```

## ğŸ“‹ è¯Šæ–­æ­¥éª¤

1. **æ£€æŸ¥å†…å­˜**ï¼š
   ```bash
   free -h
   ```

2. **æ£€æŸ¥ PM2 çŠ¶æ€**ï¼š
   ```bash
   pm2 list
   pm2 logs --lines 50
   ```

3. **æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—**ï¼š
   ```bash
   dmesg | tail -n 50
   journalctl -xe | tail -n 50
   ```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦é¢‘ç¹é‡å¯**ï¼šé¢‘ç¹é‡å¯å¯èƒ½å¯¼è‡´æ›´å¤šé—®é¢˜
2. **æ£€æŸ¥æ—¥å¿—**ï¼šæŸ¥çœ‹ PM2 æ—¥å¿—äº†è§£å…·ä½“é”™è¯¯
3. **ç›‘æ§å†…å­˜**ï¼šæŒç»­ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
4. **å¤‡ä»½æ•°æ®**ï¼šåœ¨è¿›è¡Œä»»ä½•æ“ä½œå‰ï¼Œç¡®ä¿æ•°æ®å·²å¤‡ä»½

## ğŸ¯ å¿«é€Ÿä¿®å¤å‘½ä»¤

```bash
# ä¸€é”®ä¿®å¤è„šæœ¬
cd /root/caigou/caigou
pm2 kill
sleep 3
pm2 start ecosystem.config.js
pm2 save
```

