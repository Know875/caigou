#!/bin/bash

echo "=========================================="
echo "æ¸…ç†æ¶æ„è¿›ç¨‹å’Œæ–‡ä»¶"
echo "=========================================="
echo ""

# 1. ç»ˆæ­¢æ¶æ„è¿›ç¨‹
echo "ğŸ“Š 1. ç»ˆæ­¢æ¶æ„è¿›ç¨‹"
echo "----------------------------------------"
kill -9 155845 2>/dev/null && echo "âœ“ è¿›ç¨‹ 155845 å·²ç»ˆæ­¢" || echo "âœ— è¿›ç¨‹å¯èƒ½å·²ä¸å­˜åœ¨"

# ç»ˆæ­¢ç›¸å…³è¿›ç¨‹
kill -9 155888 2>/dev/null && echo "âœ“ è¿›ç¨‹ 155888 å·²ç»ˆæ­¢" || echo "âœ— è¿›ç¨‹å¯èƒ½å·²ä¸å­˜åœ¨"

# ç­‰å¾…è¿›ç¨‹ç»ˆæ­¢
sleep 2

# ç¡®è®¤è¿›ç¨‹å·²ç»ˆæ­¢
echo ""
echo "ğŸ“Š 2. ç¡®è®¤è¿›ç¨‹å·²ç»ˆæ­¢"
echo "----------------------------------------"
ps aux | grep -E "155845|155888|fghgf|health.sh" | grep -v grep || echo "âœ“ æ‰€æœ‰æ¶æ„è¿›ç¨‹å·²ç»ˆæ­¢"

# 3. åˆ é™¤æ¶æ„æ–‡ä»¶
echo ""
echo "ğŸ“Š 3. åˆ é™¤æ¶æ„æ–‡ä»¶"
echo "----------------------------------------"
rm -f /tmp/fghgf && echo "âœ“ å·²åˆ é™¤ /tmp/fghgf" || echo "âœ— æ–‡ä»¶å¯èƒ½å·²ä¸å­˜åœ¨"
rm -f /tmp/config.json && echo "âœ“ å·²åˆ é™¤ /tmp/config.json" || echo "âœ— æ–‡ä»¶å¯èƒ½å·²ä¸å­˜åœ¨"
rm -f /dev/health.sh && echo "âœ“ å·²åˆ é™¤ /dev/health.sh" || echo "âœ— æ–‡ä»¶å¯èƒ½å·²ä¸å­˜åœ¨"

# 4. æ£€æŸ¥å®šæ—¶ä»»åŠ¡
echo ""
echo "ğŸ“Š 4. æ£€æŸ¥å®šæ—¶ä»»åŠ¡"
echo "----------------------------------------"
echo "Root crontab:"
crontab -l 2>/dev/null | grep -v "^#" | grep -v "^$" || echo "æ— å®šæ—¶ä»»åŠ¡"

echo ""
echo "ç³»ç»Ÿ crontab:"
cat /etc/crontab 2>/dev/null | grep -v "^#" | grep -v "^$" || echo "æ— å®šæ—¶ä»»åŠ¡"

echo ""
echo "Cron ç›®å½•:"
ls -la /etc/cron.d/ 2>/dev/null | head -n 10

# 5. æ£€æŸ¥å¯åŠ¨è„šæœ¬
echo ""
echo "ğŸ“Š 5. æ£€æŸ¥å¯åŠ¨è„šæœ¬"
echo "----------------------------------------"
echo "æ£€æŸ¥ systemd æœåŠ¡:"
systemctl list-units --type=service | grep -i "fghgf\|suspicious" || echo "æ— ç›¸å…³æœåŠ¡"

echo ""
echo "æ£€æŸ¥ /etc/init.d:"
ls -la /etc/init.d/ | grep -i "fghgf\|suspicious" || echo "æ— ç›¸å…³è„šæœ¬"

# 6. æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½
echo ""
echo "ğŸ“Š 6. æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½"
echo "----------------------------------------"
top -b -n 1 | head -n 5

echo ""
echo "=========================================="
echo "æ¸…ç†å®Œæˆ"
echo "=========================================="
echo ""
echo "âš ï¸  å»ºè®®åç»­æ“ä½œï¼š"
echo "1. æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—: journalctl -n 100"
echo "2. æ£€æŸ¥ç½‘ç»œè¿æ¥: ss -tunp"
echo "3. æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–å¼‚å¸¸è¿›ç¨‹: ps aux --sort=-%cpu | head -n 10"
echo "4. è€ƒè™‘æ›´æ”¹ SSH å¯†ç å’Œå¯†é’¥"
echo "5. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™: iptables -L -n"

